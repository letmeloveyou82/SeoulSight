# SeoulSight
<br>

## ëª©ì°¨
1.[ê¸°íš](#ê¸°íš)


<br>

---

<br>


## MEMBERS
|<img src="https://avatars.githubusercontent.com/u/98368034?v=4" width="150" height="150"/>|<img src="https://avatars.githubusercontent.com/u/49242646?v=4" width="150" height="150"/>|<img src="https://avatars.githubusercontent.com/u/103468518?v=4" width="150" height="150"/>|<img src="https://avatars.githubusercontent.com/u/103871252?v=4" width="150" height="150"/>|
|:-:|:-:|:-:|:-:|
|ì¥ìˆ˜í˜„<br/>[@Aunsxm](https://github.com/Aunsxm)|ìµœìœ¤ì •<br/>[@letmeloveyou82](https://github.com/letmeloveyou82)|ê¹€ì°½ì„±<br/>[@kcs19](https://github.com/kcs19)|ê¹€ìš°í˜„<br/>[@woody6624](https://github.com/woody6624)|

<br>

---

<br>

## ğŸ—’ï¸ê¸°íš

ì´ í”„ë¡œì íŠ¸ëŠ” ì„œìš¸ì‹œì˜ ì‹¤ì‹œê°„ ë„ì‹œ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ì™¸êµ­ì¸ ê´€ê´‘ê°ë“¤ì´ ê´€ê´‘ íŠ¹êµ¬(ì„œìš¸ì‹œì—ì„œ ì§€ì •í•œ ê´€ê´‘ ëª…ì†Œ)ì— ëŒ€í•œ ì •ë³´ë¥¼ ì‰½ê²Œ ì–»ì„ ìˆ˜ ìˆë„ë¡ ë•ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤. ë‚ ì”¨, ì¸êµ¬ í˜¼ì¡ë„, ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¹„ìœ¨ ë“±ì˜ ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ì—¬ ê´€ê´‘ê°ë“¤ì´ ì‹¤ì‹œê°„ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—¬í–‰ì„ ë”ìš± íš¨ê³¼ì ìœ¼ë¡œ ê³„íší•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•©ë‹ˆë‹¤.
### ëª©í‘œ

1. **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì œê³µ**: ê´€ê´‘ íŠ¹êµ¬ì˜ ë‚ ì”¨, ì¸êµ¬ í˜¼ì¡ë„, ì¸êµ¬ íŠ¹ì„± ì •ë³´ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì œê³µ.
2. **ì •ë³´ ì ‘ê·¼ì„± í–¥ìƒ**: ë³µì¡í•œ ë°ì´í„°ë¥¼ ì§ê´€ì ìœ¼ë¡œ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì‹œê°í™”.
3. **ê´€ê´‘ í¸ì˜ì„± ì¦ëŒ€**: ì‹¤ì‹œê°„ ë° ì˜ˆì¸¡ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íš¨ê³¼ì ì¸ ì—¬í–‰ ê³„íš ìˆ˜ë¦½ ì§€ì›.

### ì£¼ìš” ê¸°ëŠ¥

1. **ë‚ ì”¨ ì •ë³´ ì œê³µ**: ê° ê´€ê´‘ íŠ¹êµ¬ì˜ ì‹¤ì‹œê°„ ë‚ ì”¨ ì •ë³´ë¥¼ ì œê³µí•˜ì—¬ ì•¼ì™¸ í™œë™ ì¤€ë¹„ë¥¼ ë•ìŠµë‹ˆë‹¤.
2. **ì¸êµ¬ í˜¼ì¡ë„ ì •ë³´ ì œê³µ**: ê´€ê´‘ íŠ¹êµ¬ì˜ ì¸êµ¬ ë°€ì§‘ë„ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•©ë‹ˆë‹¤.
3. **ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ ë¹„ìœ¨ ì œê³µ**: ê´€ê´‘ íŠ¹êµ¬ë³„ ì—°ë ¹ëŒ€ ì¸êµ¬ ë¹„ìœ¨ì„ ì‹œê°í™”í•˜ì—¬ ë‹¤ì–‘í•œ ì—°ë ¹ì¸µì˜ ê´€ì‹¬ì„ ì¶©ì¡±ì‹œí‚µë‹ˆë‹¤.

<br>

---

<br>

## ğŸ‘¨â€ğŸ’»ê¸°ìˆ ìŠ¤íƒ

| **ì—­í• **            | **ì¢…ë¥˜**                                                                                                              |
|----------------------|-----------------------------------------------------------------------------------------------------------------------|
| ğŸ¤ í˜‘ì—… ë„êµ¬         | ![Git](https://img.shields.io/badge/git-%23F05033.svg?style=for-the-badge&logo=git&logoColor=white) <br> ![GitHub](https://img.shields.io/badge/github-%23121011.svg?style=for-the-badge&logo=github&logoColor=white) |
| ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤      | ![MySQL](https://img.shields.io/badge/mysql-4479A1.svg?style=for-the-badge&logo=mysql&logoColor=white) <br> ![DBeaver](https://img.shields.io/badge/dbeaver-372923.svg?style=for-the-badge&logo=dbeaver&logoColor=white) |
| ğŸ’¬ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ë„êµ¬ | ![Notion](https://img.shields.io/badge/Notion-%23000000.svg?style=for-the-badge&logo=notion&logoColor=white) <br> ![Slack](https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=slack&logoColor=white) |
| ğŸ› ï¸ ê°œë°œ ë° ê´€ë¦¬ ë„êµ¬ | ![MobaXterm](https://img.shields.io/badge/mobaxterm-2C2E34.svg?style=for-the-badge&logo=mobaxterm&logoColor=white) <br> ![Elasticsearch](https://img.shields.io/badge/elasticsearch-%230377CC.svg?style=for-the-badge&logo=elasticsearch&logoColor=white)<br>![Logstash](https://img.shields.io/badge/Logstash-005571.svg?&style=for-the-badge&logo=Logstash&logoColor=white)|
| :eyes: ì‹œê°í™” ë„êµ¬ | ![Kibana](https://img.shields.io/badge/Kibana-E8478B.svg?&style=for-the-badge&logo=Kibana&logoColor=white)|

<br>

---

<br>


## ì•„í‚¤í…ì²˜
![Image](https://github.com/user-attachments/assets/52c258f3-f856-476a-9e4e-cdaf404212ee)

<br>

---

<br>

## ì‚¬ìš©í•œ í•„ë“œ ì„¤ëª…

| **í•„ë“œëª…**          | **ë°ì´í„° íƒ€ì…**      | **ë‚´ìš©**                                                                 |
|----------------------|----------------------|---------------------------------------------------------------------------|
| `area_nm`           | `VARCHAR(255)`      | ì§€ì—­ ì´ë¦„ (ì˜ˆ: ê´‘í™”ë¬¸Â·ë•ìˆ˜ê¶)                                             |
| `area_cd`           | `VARCHAR(50)`       | ì§€ì—­ ì½”ë“œ (ì˜ˆ: POI009)                                                   |
| `area_congest_lvl`  | `VARCHAR(50)`       | í˜¼ì¡ ìˆ˜ì¤€ (ì˜ˆ: ì•½ê°„ ë¶ë¹”)                                                 |
| `area_congest_msg`  | `TEXT`              | í˜¼ì¡ ë©”ì‹œì§€                                                              |
| `area_ppltn_min`    | `INT`               | ìµœì†Œ ì¸êµ¬ ìˆ˜ (ì˜ˆ: 40000)                                                 |
| `area_ppltn_max`    | `INT`               | ìµœëŒ€ ì¸êµ¬ ìˆ˜ (ì˜ˆ: 42000)                                                 |
| `male_ppltn_rate`   | `FLOAT`             | ë‚¨ì„± ì¸êµ¬ ë¹„ìœ¨ (ì˜ˆ: 50.8)                                                |
| `female_ppltn_rate` | `FLOAT`             | ì—¬ì„± ì¸êµ¬ ë¹„ìœ¨ (ì˜ˆ: 49.2)                                                |
| `ppltn_rate_0`      | `FLOAT`             | 0ëŒ€ ì¸êµ¬ ë¹„ìœ¨ (ì˜ˆ: 0.1)                                                  |
| `ppltn_rate_10`     | `FLOAT`             | 10ëŒ€ ì¸êµ¬ ë¹„ìœ¨ (ì˜ˆ: 1.3)                                                 |
| `ppltn_rate_20`     | `FLOAT`             | 20ëŒ€ ì¸êµ¬ ë¹„ìœ¨ (ì˜ˆ: 15.5)                                                |
| `ppltn_rate_30`     | `FLOAT`             | 30ëŒ€ ì¸êµ¬ ë¹„ìœ¨ (ì˜ˆ: 27.6)                                                |
| `ppltn_rate_40`     | `FLOAT`             | 40ëŒ€ ì¸êµ¬ ë¹„ìœ¨ (ì˜ˆ: 27.3)                                                |
| `ppltn_rate_50`     | `FLOAT`             | 50ëŒ€ ì¸êµ¬ ë¹„ìœ¨ (ì˜ˆ: 17.3)                                                |
| `ppltn_rate_60`     | `FLOAT`             | 60ëŒ€ ì¸êµ¬ ë¹„ìœ¨ (ì˜ˆ: 7.2)                                                 |
| `ppltn_rate_70`     | `FLOAT`             | 70ëŒ€ ì´ìƒ ì¸êµ¬ ë¹„ìœ¨ (ì˜ˆ: 3.7)                                            |
| `temp`              | `FLOAT`             | í˜„ì¬ ì˜¨ë„ (ì˜ˆ: 4.7)                                                      |
| `sensible_temp`     | `FLOAT`             | ì²´ê° ì˜¨ë„ (ì˜ˆ: 4.8)                                                      |
| `wind_spd`          | `FLOAT`             | í’ì† (ì˜ˆ: 2.8)                                                           |
| `precipitation`     | `VARCHAR(50)`       | ê°•ìˆ˜ëŸ‰ (ì˜ˆ: -)                                                           |
| `pcp_msg`           | `TEXT`              | ê°•ìˆ˜ ë©”ì‹œì§€ (ì˜ˆ: ë¹„ ë˜ëŠ” ëˆˆ ì†Œì‹ì´ ì—†ì–´ìš”.)                              |
| `uv_index`          | `VARCHAR(50)`       | ìì™¸ì„  ì§€ìˆ˜ (ì˜ˆ: ë‚®ìŒ)                                                   |
| `uv_msg`            | `TEXT`              | ìì™¸ì„  ë©”ì‹œì§€                                                            |
| `pm25_index`        | `VARCHAR(50)`       | PM2.5 ì§€ìˆ˜ (ì˜ˆ: ë§¤ìš°ë‚˜ì¨)                                                |
| `pm25`              | `INT`               | PM2.5 ë†ë„ (ì˜ˆ: 125)                                                     |
| `pm10_index`        | `VARCHAR(50)`       | PM10 ì§€ìˆ˜ (ì˜ˆ: ë‚˜ì¨)                                                     |
| `pm10`              | `INT`               | PM10 ë†ë„ (ì˜ˆ: 138)                                                      |
| `air_idx`           | `VARCHAR(50)`       | ëŒ€ê¸°ì§ˆ ì§€ìˆ˜ (ì˜ˆ: ì ê²€ì¤‘)                                                 |
| `air_idx_mvl`       | `VARCHAR(50)`       | ëŒ€ê¸°ì§ˆ ì´ë™ ì§€ìˆ˜ (ì˜ˆ: ì ê²€ì¤‘)                                            |
| `air_msg`           | `TEXT`              | ëŒ€ê¸°ì§ˆ ë©”ì‹œì§€                                                            |
| `weather_time`      | `DATETIME`          | ë‚ ì”¨ ë°ì´í„° ì‹œê°„ (ì˜ˆ: 2025-01-21 12:40)                                  |
| `warn_val`          | `VARCHAR(50)`       | ê²½ê³  ê°’ (ì˜ˆ: í•œíŒŒ)                                                       |
| `warn_stress`       | `VARCHAR(50)`       | ê²½ê³  ìˆ˜ì¤€ (ì˜ˆ: ì£¼ì˜ë³´)                                                   |
| `announce_time`     | `INT`               | ë°œí‘œ ì‹œê°„ (ì˜ˆ: 0)                                                        |
| `command`           | `VARCHAR(50)`       | ëª…ë ¹ ìƒíƒœ (ì˜ˆ: í•´ì œ)                                                     |
| `cancel_yn`         | `VARCHAR(50)`       | ì·¨ì†Œ ì—¬ë¶€ (ì˜ˆ: ì •ìƒ)                                                     |
| `warn_msg`          | `TEXT`              | ê²½ê³  ë©”ì‹œì§€ (ì˜ˆ: í•´ë‹¹ íŠ¹ë³´ëŠ” í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.)                            |

---


## ì‹œê°í™” ë°ì´í„°
<table>
  <tr>
    <td><img src="https://github.com/user-attachments/assets/1511ac5c-4690-41ea-9e25-1853b04565d4" alt="Image"></td>
    <td><img src="https://github.com/user-attachments/assets/517c7b3c-8ef1-46a6-be71-3abf5b541cd9" alt="Image"></td>
  </tr>
  <tr>
    <td><img src="https://github.com/user-attachments/assets/dd4c6edc-e142-44f8-bc24-bab4b061b561" alt="Image"></td>
    <td><img src="https://github.com/user-attachments/assets/9c75434d-9613-4f00-b713-8c2d872d06f5" alt="Image"></td>
  </tr>
  <tr>
    <td colspan="2"><img src="https://github.com/user-attachments/assets/c6b9a6a3-97d2-4772-85b6-3c3d34fba3ab" alt="Image"></td>
  </tr>
</table>


## ë°ì´í„° íŒŒì‹±

#### 1. XMLí˜•ì‹ ë°ì´í„° íŒŒì‹±
ì œê³µë°›ì€ APIì˜ ë°ì´í„° í˜•ì‹ì´ XMLì´ì—ˆê¸° ë•Œë¬¸ì—, í•„ìš”í•œ ì •ë³´ë§Œ ì¶”ì¶œí•˜ì—¬ ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ë°˜í™˜í•˜ì˜€ìŠµë‹ˆë‹¤.
```
def fetch_and_parse_api_data(api_key, area_name):
    url = f'http://openapi.seoul.go.kr:8088/{api_key}/xml/citydata/1/5/{area_name}'
    response = requests.get(url)

    if response.status_code == 200:
        root = ET.fromstring(response.content)
        data = {
            "area_nm": root.findtext('.//AREA_NM', default=''),
            "area_cd": root.findtext('.//AREA_CD', default=''),
           ...
            "warn_msg": root.findtext('.//WARN_MSG', default='')
        }
        
        
        return data
    else:
        print(f"Failed to fetch data: {response.status_code}")
        return None
```

#### 2. mysql ë°ì´í„° ì‚½ì…
10ë¶„ë§ˆë‹¤ ìµœì‹  ë°ì´í„°ë¥¼ MySQL ë°ì´í„°ë² ì´ìŠ¤ì— ì—…ë°ì´íŠ¸í•˜ì—¬ ìµœì‹  ì •ë³´ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
í•´ë‹¹ ë°ì´í„°ê°€ ì´ë¯¸ ë°ì´í„°ë² ì´ìŠ¤ì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê³ , ì¡´ì¬í•˜ë©´ ê°±ì‹ í•˜ê³ , ì—†ìœ¼ë©´ ìƒˆë¡œ ì‚½ì…í•©ë‹ˆë‹¤.
```
def upsert_data_into_mysql(data, db_config, table_name):
    connection = pymysql.connect(**db_config)
    try:
        with connection.cursor() as cursor:
            # Check if area_cd already exists
            select_sql = f"SELECT COUNT(*) FROM {table_name} WHERE area_cd = %s"
            cursor.execute(select_sql, (data["area_cd"],))
            result = cursor.fetchone()

            if result[0] > 0:  # area_cd exists, perform UPDATE
                update_columns = ", ".join([f"{key} = %s" for key in data.keys()])
                update_sql = f"UPDATE {table_name} SET {update_columns} WHERE area_cd = %s"
                cursor.execute(update_sql, list(data.values()) + [data["area_cd"]])
                print(f"Data for {data['area_cd']} has been updated.")
            else:  # area_cd does not exist, perform INSERT
                columns = ", ".join(data.keys())
                placeholders = ", ".join(["%s"] * len(data))
                insert_sql = f"INSERT INTO {table_name} ({columns}) VALUES ({placeholders})"
                cursor.execute(insert_sql, list(data.values()))
                print(f"Data for {data['area_cd']} has been inserted into the database.")

            connection.commit()

    except Exception as e:
        print(f"MySQL error: {e}")
    finally:
        connection.close()


if __name__ == "__main__":
  while True:
          # Fetch and insert or update data for each area
          for area in areas:
              parsed_data = fetch_and_parse_api_data(API_KEY, area)
              if parsed_data:
                  upsert_data_into_mysql(parsed_data, DB_CONFIG, TABLE_NAME)
          
          print("Waiting for 10 minutes before the next fetch...")
          time.sleep(600)  # 600 seconds = 10 minutes
```



## íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
ì£¼ì œ : ìš´ì˜ì²´ì œì— ì„¤ì¹˜ëœ JDK-17ë¡œ Logstash êµ¬ë™í•˜ê¸°

ë¬¸ì œ : Logstashê°€ ì„œë¸Œ í”„ë¡œì„¸ìŠ¤ë“¤ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•˜ì—¬ JDKì˜ IO ì„œë¸Œ ì‹œìŠ¤í…œì— ëŒ€í•˜ì—¬ open accessê¶Œí•œì„ ìš”ì²­í•˜ì§€ë§Œ JDK ë²„ì „ì˜ ë¬¸ì œë¡œ IO ì„œë¸Œ ì‹œìŠ¤í…œì— ëŒ€í•œ ì ‘ê·¼ì´ ì œí•œë˜ì–´ ë¬¸ì œê°€ ë°œìƒ

### JDK 16ì—ì„œì˜ ë³€í™”
ì¶œì²˜ : https://blogs.oracle.com/javakr/post/jdk-16

JEP 396:Â JDK ë‚´ë¶€ë¥¼ ê°•ë ¥í•˜ê²Œ ìº¡ìŠí™”Â Â - JDK 9ì—ì„œ ë‚´ë¶€ APIë¥¼ ê°•ë ¥í•˜ê²Œ ìº¡ìŠí™”í•˜ì—¬ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ì œí•œ
ì´ë¡œ ì¸í•˜ì—¬ open accessê¶Œí•œì´ ì œí•œë©ë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•´ì£¼ì–´ì•¼ Warningì— ëŒ€í•œ ë¬¸ì œê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.

```
WARNING, using JAVA_HOME while Logstash distribution comes with a bundled JDK
2025-01-21T17:34:36.483+09:00 [main] WARN FilenoUtil : Native subprocess control requires open access to the JDK IO subsystem
Pass '--add-opens java.base/sun.nio.ch=ALL-UNNAMED --add-opens java.base/java.io=ALL-UNNAMED' to enable.
```
![Image](https://github.com/user-attachments/assets/ac747e92-2754-4d2b-b851-6a7a8c508067)

### í•´ê²° ë°©ë²•
íŒŒì¼ ìˆ˜ì • - logstash í•˜ë‹¨ì˜ jvm.options íŒŒì¼ ìˆ˜ì •
```
-Xmx1g ë°‘ ë¶€ë¶„ì—
--add-opens java.base/sun.nio.ch=ALL-UNNAMED
--add-opens java.base/java.io=ALL-UNNAMED
ë¥¼ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

ì²«ë²ˆì§¸ ëª…ë ¹ì–´ëŠ” module-info.javaê°€ ì—†ëŠ” ëª¨ë“  unnamed ëª¨ë“ˆì—ì„œ JDKì˜ ê¸°ë³¸ ëª¨ë“ˆì—ì„œ
ì €ìˆ˜ì¤€ I/Oê´€ë ¨ í´ë˜ìŠ¤ë“¤ì„ í¬í•¨í•˜ê³  ìˆëŠ” JAVA NIO ë‚´ë¶€ êµ¬í˜„ê³¼ ê´€ë ¨ëœ íŒ¨í‚¤ì§€ì— ì ‘ê·¼ì„ 
ê°€ëŠ¥í•˜ê²Œ í•´ì¤ë‹ˆë‹¤.
ë‘ë²ˆì§¸ ëª…ë ¹ì–´ëŠ” java.ioíŒ¨í‚¤ì§€ì— ëª¨ë“  unnamed ëª¨ë“ˆì´ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•´ì¤ë‹ˆë‹¤.

ë˜í•œ ## GC configuration ë°‘ ë¶€ë¶„ì— 
-XX:+IgnoreUnrecognizedVMOptions
ë¥¼ ì¶”ê°€í•˜ì—¬ í˜¹ì—¬ë‚˜ JVM ë²„ì „ ì°¨ì´ë¡œ ì¸í•˜ì—¬ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ” ëª…ë ¹ì´ ìˆì„ ê²½ìš° ë¬´ì‹œí•˜ëŠ” ì˜µì…˜ì„
ì¶”ê°€í•©ë‹ˆë‹¤.
```

### ê²°ê³¼
FilenoUtilì— ëŒ€í•œ Openacess ê¶Œí•œ ë¬¸ì œì— ëŒ€í•œ ë‚´ìš©ì´ í•´ê²°ë˜ì–´ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
![Image](https://github.com/user-attachments/assets/1960d0b2-0dbd-462b-9f98-546ce40e0147)
```
C:\02.devEnv\ELK\logstash-7.11.1\bin>logstash -f ../config/test.conf
Using JAVA_HOME defined java: C:\02.devEnv\jdk-17
WARNING, using JAVA_HOME while Logstash distribution comes with a bundled JDK
Sending Logstash logs to C:/02.devEnv/ELK/logstash-7.11.1/logs which is now configured via log4j2.properties
```
